{"ast":null,"code":"import { API_BASE_URL } from '../utils/constants';\nclass ApiService {\n  constructor() {\n    this.baseURL = API_BASE_URL;\n  }\n  getAuthHeaders() {\n    const token = localStorage.getItem('token');\n    return {\n      'Content-Type': 'application/json',\n      ...(token && {\n        'Authorization': `Bearer ${token}`\n      })\n    };\n  }\n  async request(endpoint, options = {}) {\n    const url = `${this.baseURL}${endpoint}`;\n    console.log('API Request URL:', url); // Debug log\n\n    const config = {\n      headers: this.getAuthHeaders(),\n      mode: 'cors',\n      ...options\n    };\n    try {\n      const response = await fetch(url, config);\n      if (!response.ok) {\n        if (response.status === 401) {\n          localStorage.removeItem('token');\n          localStorage.removeItem('user');\n          window.location.href = '/login';\n          return;\n        }\n        const errorData = await response.json().catch(() => ({}));\n        const errorMessage = errorData.detail || errorData.message || `HTTP ${response.status}`;\n        throw new Error(errorMessage);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('API Error:', error);\n      if (error.name === 'TypeError' && error.message.includes('fetch')) {\n        throw new Error('Serverga ulanishda xatolik. Backend server ishlamayotgan bo\\'lishi mumkin.');\n      }\n      if (error.message.includes('CORS')) {\n        throw new Error('CORS xatoligi. Backend CORS sozlamalarini tekshiring.');\n      }\n      throw error;\n    }\n  }\n\n  // Auth\n  async login(credentials) {\n    return this.request('/auth/login', {\n      method: 'POST',\n      body: JSON.stringify(credentials)\n    });\n  }\n  async getCurrentUser() {\n    return this.request('/auth/me');\n  }\n\n  // Users\n  async getUsers(params = {}) {\n    const query = new URLSearchParams(params).toString();\n    return this.request(`/admin/users?${query}`);\n  }\n  async createUser(userData) {\n    return this.request('/admin/users', {\n      method: 'POST',\n      body: JSON.stringify(userData)\n    });\n  }\n  async updateUser(userId, userData) {\n    return this.request(`/admin/users/${userId}`, {\n      method: 'PATCH',\n      body: JSON.stringify(userData)\n    });\n  }\n  async deleteUser(userId) {\n    return this.request(`/admin/users/${userId}`, {\n      method: 'DELETE'\n    });\n  }\n  async resetUserPassword(userId) {\n    return this.request(`/admin/users/${userId}/reset-password`, {\n      method: 'POST'\n    });\n  }\n\n  // Students\n  async searchStudents(params = {}) {\n    // Remove empty values to avoid 422 errors\n    const cleanParams = Object.fromEntries(Object.entries(params).filter(([key, value]) => value !== '' && value !== null && value !== undefined));\n    const query = new URLSearchParams(cleanParams).toString();\n    return this.request(`/admin/students/search?${query}`);\n  }\n  async createStudent(studentData) {\n    return this.request('/admin/students', {\n      method: 'POST',\n      body: JSON.stringify(studentData)\n    });\n  }\n\n  // Groups\n  async getGroups() {\n    return this.request('/admin/groups');\n  }\n  async createGroup(groupData) {\n    return this.request('/admin/groups', {\n      method: 'POST',\n      body: JSON.stringify(groupData)\n    });\n  }\n\n  // Subjects\n  async getSubjects() {\n    return this.request('/admin/subjects');\n  }\n  async createSubject(subjectData) {\n    return this.request('/admin/subjects', {\n      method: 'POST',\n      body: JSON.stringify(subjectData)\n    });\n  }\n\n  // Payments\n  async getPayments(params = {}) {\n    const query = new URLSearchParams(params).toString();\n    return this.request(`/admin/payments?${query}`);\n  }\n  async createPayment(paymentData) {\n    return this.request('/admin/payments', {\n      method: 'POST',\n      body: JSON.stringify(paymentData)\n    });\n  }\n  async updatePayment(paymentId, updateData) {\n    return this.request(`/admin/payments/${paymentId}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updateData)\n    });\n  }\n\n  // News\n  async getNews() {\n    return this.request('/admin/news');\n  }\n  async createNews(newsData) {\n    return this.request('/admin/news', {\n      method: 'POST',\n      body: JSON.stringify(newsData)\n    });\n  }\n  async deleteNews(newsId) {\n    return this.request(`/admin/news/${newsId}`, {\n      method: 'DELETE'\n    });\n  }\n\n  // Reports\n  async getOverviewReport() {\n    return this.request('/admin/reports/overview');\n  }\n  async getClassReport(groupId, subjectId) {\n    return this.request(`/admin/reports/class?group_id=${groupId}&subject_id=${subjectId}`);\n  }\n  async getPaymentReport(month, year) {\n    return this.request(`/admin/reports/payments?month=${month}&year=${year}`);\n  }\n\n  // File upload\n  async uploadFile(file) {\n    const formData = new FormData();\n    formData.append('file', file);\n    const token = localStorage.getItem('token');\n    const response = await fetch(`${this.baseURL}/upload`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`\n      },\n      body: formData\n    });\n    if (!response.ok) {\n      throw new Error('Fayl yuklashda xatolik');\n    }\n    return await response.json();\n  }\n}\nconst apiService = new ApiService();\nexport default apiService;","map":{"version":3,"names":["API_BASE_URL","ApiService","constructor","baseURL","getAuthHeaders","token","localStorage","getItem","request","endpoint","options","url","console","log","config","headers","mode","response","fetch","ok","status","removeItem","window","location","href","errorData","json","catch","errorMessage","detail","message","Error","error","name","includes","login","credentials","method","body","JSON","stringify","getCurrentUser","getUsers","params","query","URLSearchParams","toString","createUser","userData","updateUser","userId","deleteUser","resetUserPassword","searchStudents","cleanParams","Object","fromEntries","entries","filter","key","value","undefined","createStudent","studentData","getGroups","createGroup","groupData","getSubjects","createSubject","subjectData","getPayments","createPayment","paymentData","updatePayment","paymentId","updateData","getNews","createNews","newsData","deleteNews","newsId","getOverviewReport","getClassReport","groupId","subjectId","getPaymentReport","month","year","uploadFile","file","formData","FormData","append","apiService"],"sources":["/Users/abdulazim/Documents/web_stuff/real-projects/toshmi-admin/src/services/api.js"],"sourcesContent":["import { API_BASE_URL } from '../utils/constants';\n\nclass ApiService {\n  constructor() {\n    this.baseURL = API_BASE_URL;\n  }\n\n  getAuthHeaders() {\n    const token = localStorage.getItem('token');\n    return {\n      'Content-Type': 'application/json',\n      ...(token && { 'Authorization': `Bearer ${token}` })\n    };\n  }\n\n  async request(endpoint, options = {}) {\n    const url = `${this.baseURL}${endpoint}`;\n    console.log('API Request URL:', url); // Debug log\n    \n    const config = {\n      headers: this.getAuthHeaders(),\n      mode: 'cors',\n      ...options\n    };\n\n    try {\n      const response = await fetch(url, config);\n      \n      if (!response.ok) {\n        if (response.status === 401) {\n          localStorage.removeItem('token');\n          localStorage.removeItem('user');\n          window.location.href = '/login';\n          return;\n        }\n        const errorData = await response.json().catch(() => ({}));\n        const errorMessage = errorData.detail || errorData.message || `HTTP ${response.status}`;\n        throw new Error(errorMessage);\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('API Error:', error);\n      \n      if (error.name === 'TypeError' && error.message.includes('fetch')) {\n        throw new Error('Serverga ulanishda xatolik. Backend server ishlamayotgan bo\\'lishi mumkin.');\n      }\n      if (error.message.includes('CORS')) {\n        throw new Error('CORS xatoligi. Backend CORS sozlamalarini tekshiring.');\n      }\n      throw error;\n    }\n  }\n\n  // Auth\n  async login(credentials) {\n    return this.request('/auth/login', {\n      method: 'POST',\n      body: JSON.stringify(credentials)\n    });\n  }\n\n  async getCurrentUser() {\n    return this.request('/auth/me');\n  }\n\n  // Users\n  async getUsers(params = {}) {\n    const query = new URLSearchParams(params).toString();\n    return this.request(`/admin/users?${query}`);\n  }\n\n  async createUser(userData) {\n    return this.request('/admin/users', {\n      method: 'POST',\n      body: JSON.stringify(userData)\n    });\n  }\n\n  async updateUser(userId, userData) {\n    return this.request(`/admin/users/${userId}`, {\n      method: 'PATCH',\n      body: JSON.stringify(userData)\n    });\n  }\n\n  async deleteUser(userId) {\n    return this.request(`/admin/users/${userId}`, {\n      method: 'DELETE'\n    });\n  }\n\n  async resetUserPassword(userId) {\n    return this.request(`/admin/users/${userId}/reset-password`, {\n      method: 'POST'\n    });\n  }\n\n  // Students\n  async searchStudents(params = {}) {\n    // Remove empty values to avoid 422 errors\n    const cleanParams = Object.fromEntries(\n      Object.entries(params).filter(([key, value]) => value !== '' && value !== null && value !== undefined)\n    );\n    const query = new URLSearchParams(cleanParams).toString();\n    return this.request(`/admin/students/search?${query}`);\n  }\n\n  async createStudent(studentData) {\n    return this.request('/admin/students', {\n      method: 'POST',\n      body: JSON.stringify(studentData)\n    });\n  }\n\n  // Groups\n  async getGroups() {\n    return this.request('/admin/groups');\n  }\n\n  async createGroup(groupData) {\n    return this.request('/admin/groups', {\n      method: 'POST',\n      body: JSON.stringify(groupData)\n    });\n  }\n\n  // Subjects\n  async getSubjects() {\n    return this.request('/admin/subjects');\n  }\n\n  async createSubject(subjectData) {\n    return this.request('/admin/subjects', {\n      method: 'POST',\n      body: JSON.stringify(subjectData)\n    });\n  }\n\n  // Payments\n  async getPayments(params = {}) {\n    const query = new URLSearchParams(params).toString();\n    return this.request(`/admin/payments?${query}`);\n  }\n\n  async createPayment(paymentData) {\n    return this.request('/admin/payments', {\n      method: 'POST',\n      body: JSON.stringify(paymentData)\n    });\n  }\n\n  async updatePayment(paymentId, updateData) {\n    return this.request(`/admin/payments/${paymentId}`, {\n      method: 'PATCH',\n      body: JSON.stringify(updateData)\n    });\n  }\n\n  // News\n  async getNews() {\n    return this.request('/admin/news');\n  }\n\n  async createNews(newsData) {\n    return this.request('/admin/news', {\n      method: 'POST',\n      body: JSON.stringify(newsData)\n    });\n  }\n\n  async deleteNews(newsId) {\n    return this.request(`/admin/news/${newsId}`, {\n      method: 'DELETE'\n    });\n  }\n\n  // Reports\n  async getOverviewReport() {\n    return this.request('/admin/reports/overview');\n  }\n\n  async getClassReport(groupId, subjectId) {\n    return this.request(`/admin/reports/class?group_id=${groupId}&subject_id=${subjectId}`);\n  }\n\n  async getPaymentReport(month, year) {\n    return this.request(`/admin/reports/payments?month=${month}&year=${year}`);\n  }\n\n  // File upload\n  async uploadFile(file) {\n    const formData = new FormData();\n    formData.append('file', file);\n    \n    const token = localStorage.getItem('token');\n    const response = await fetch(`${this.baseURL}/upload`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`\n      },\n      body: formData\n    });\n\n    if (!response.ok) {\n      throw new Error('Fayl yuklashda xatolik');\n    }\n\n    return await response.json();\n  }\n}\n\nconst apiService = new ApiService();\nexport default apiService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}