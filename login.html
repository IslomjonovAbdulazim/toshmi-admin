<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirish - Admin Panel</title>

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/main.css">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
</head>

<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 to-purple-700">
    <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
        <!-- Logo and Title -->
        <div class="text-center mb-8">
            <div class="mx-auto h-16 w-16 mb-4">
                <img src="assets/images/logo.png" alt="Logo" class="h-full w-full object-contain"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                <div class="h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center" style="display: none;">
                    <i class="fas fa-graduation-cap text-white text-2xl"></i>
                </div>
            </div>
            <h2 class="text-3xl font-bold text-gray-900 mb-2">Admin Panel</h2>
            <p class="text-gray-600">Maktab Boshqaruv Tizimi</p>
            <p class="text-sm text-gray-500 mt-2">Administrator sifatida kirish</p>
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="space-y-6">
            <div>
                <label for="phoneInput" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-phone mr-2"></i>Telefon raqam
                </label>
                <input type="tel" id="phoneInput" required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"
                    placeholder="+998 90 123 45 67" autocomplete="tel">
            </div>

            <div>
                <label for="passwordInput" class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-lock mr-2"></i>Parol
                </label>
                <div class="relative">
                    <input type="password" id="passwordInput" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"
                        placeholder="••••••••" autocomplete="current-password">
                    <button type="button" id="togglePassword"
                        class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                <i class="fas fa-exclamation-circle mr-2"></i>
                <span id="errorText"></span>
            </div>

            <button type="submit" id="loginBtn"
                class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                <span id="loginBtnText" class="flex items-center">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Kirish
                </span>
            </button>
        </form>

        <!-- Additional Info -->
        <div class="mt-6 text-center text-sm text-gray-500">
            <p>Faqat administratorlar kirishi mumkin</p>
            <p class="mt-2">Parolni unutdingizmi? Bosh administratorga murojaat qiling</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Check if already logged in
            if (isAuthenticated()) {
                window.location.href = 'index.html';
                return;
            }

            // Password toggle functionality
            document.getElementById('togglePassword').addEventListener('click', function () {
                const passwordInput = document.getElementById('passwordInput');
                const icon = this.querySelector('i');

                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });

            // Login form submission
            document.getElementById('loginForm').addEventListener('submit', async function (e) {
                e.preventDefault();

                const phoneInput = document.getElementById('phoneInput');
                const passwordInput = document.getElementById('passwordInput');
                const loginBtn = document.getElementById('loginBtn');
                const loginBtnText = document.getElementById('loginBtnText');
                const errorMessage = document.getElementById('errorMessage');
                const errorText = document.getElementById('errorText');

                // Clear previous errors
                errorMessage.classList.add('hidden');

                // Validate inputs
                if (!phoneInput.value.trim()) {
                    showError('Telefon raqamni kiriting');
                    return;
                }

                if (!passwordInput.value) {
                    showError('Parolni kiriting');
                    return;
                }

                // Show loading state
                loginBtn.disabled = true;
                loginBtnText.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Yuklanmoqda...';

                try {
                    const success = await login(phoneInput.value, passwordInput.value);

                    if (success) {
                        // Success - redirect to dashboard
                        window.location.href = 'index.html';
                    } else {
                        showError('Noto\'g\'ri telefon raqam yoki parol');
                    }
                } catch (error) {
                    showError('Tizimda xatolik yuz berdi. Qaytadan urinib ko\'ring');
                    console.error('Login error:', error);
                } finally {
                    // Reset button state
                    loginBtn.disabled = false;
                    loginBtnText.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>Kirish';
                }

                function showError(message) {
                    errorText.textContent = message;
                    errorMessage.classList.remove('hidden');
                }
            });

            // Phone number formatting
            document.getElementById('phoneInput').addEventListener('input', function (e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.startsWith('998')) {
                    value = value.substring(3);
                }

                // Format: +998 XX XXX XX XX
                if (value.length >= 2) {
                    value = value.replace(/(\d{2})(\d{3})(\d{2})(\d{2})/, '$1 $2 $3 $4');
                }

                e.target.value = '+998 ' + value;
            });

            // Add enter key support for better UX
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    document.getElementById('loginForm').dispatchEvent(new Event('submit'));
                }
            });
        });
    </script>
</body>

</html>